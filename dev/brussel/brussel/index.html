<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Brusselator · Decapodes.jl</title><meta name="title" content="Brusselator · Decapodes.jl"/><meta property="og:title" content="Brusselator · Decapodes.jl"/><meta property="twitter:title" content="Brusselator · Decapodes.jl"/><meta name="description" content="Documentation for Decapodes.jl."/><meta property="og:description" content="Documentation for Decapodes.jl."/><meta property="twitter:description" content="Documentation for Decapodes.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><script src="../../assets/analytics.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Decapodes.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Decapodes.jl</a></li><li><a class="tocitem" href="../../overview/overview/">Overview</a></li><li><a class="tocitem" href="../../ice_dynamics/ice_dynamics/">Glacial Flow</a></li><li><span class="tocitem">Concepts</span><ul><li><a class="tocitem" href="../../concepts/equations/">Equations</a></li><li><a class="tocitem" href="../../concepts/composition/">Composition</a></li><li><a class="tocitem" href="../../concepts/meshes/">Meshes</a></li><li><a class="tocitem" href="../../concepts/generate/">Custom Operators</a></li></ul></li><li><span class="tocitem">Zoo</span><ul><li><a class="tocitem" href="../../navier_stokes/ns/">Vortices</a></li><li><a class="tocitem" href="../../harmonics/harmonics/">Harmonics</a></li><li><a class="tocitem" href="../../ch/cahn-hilliard/">Cahn-Hilliard</a></li><li class="is-active"><a class="tocitem" href>Brusselator</a><ul class="internal"><li><a class="tocitem" href="#Dependencies"><span>Dependencies</span></a></li><li><a class="tocitem" href="#The-Model"><span>The Model</span></a></li><li><a class="tocitem" href="#Boundary-Conditions"><span>Boundary Conditions</span></a></li><li><a class="tocitem" href="#The-Mesh"><span>The Mesh</span></a></li><li><a class="tocitem" href="#Initial-data"><span>Initial data</span></a></li><li><a class="tocitem" href="#Generate-the-Simulation"><span>Generate the Simulation</span></a></li><li><a class="tocitem" href="#Visualize"><span>Visualize</span></a></li></ul></li><li><a class="tocitem" href="../../klausmeier/klausmeier/">Klausmeier</a></li><li><a class="tocitem" href="../../pconv/porous_convection/">Porous Convection</a></li><li><a class="tocitem" href="../../cism/cism/">CISM v2.1</a></li><li><a class="tocitem" href="../../grigoriev/grigoriev/">Grigoriev Ice Cap</a></li><li><a class="tocitem" href="../../bsh/budyko_sellers_halfar/">Budyko-Sellers-Halfar</a></li><li><a class="tocitem" href="../../ebm_melt/ebm_melt/">Halfar-EBM-Water</a></li><li><a class="tocitem" href="../../halmo/halmo/">Halfar-NS</a></li><li><a class="tocitem" href="../../nhs/nhs_lite/">NHS</a></li><li><a class="tocitem" href="../../poiseuille/poiseuille/">Pipe Flow</a></li><li><a class="tocitem" href="../../fokker_planck/fokker_planck/">Fokker-Planck</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/chemistry/gray_scott/">Gray-Scott</a></li><li><a class="tocitem" href="../../examples/oncology/tumor_proliferation_invasion/">Oncology</a></li><li><a class="tocitem" href="../../examples/mhd/">MHD</a></li></ul></li><li><a class="tocitem" href="../../calibrate/calibration/">Calibration</a></li><li><a class="tocitem" href="../../bc/bc_debug/">Misc Features</a></li><li><a class="tocitem" href="../../faq/faq/">FAQ</a></li><li><a class="tocitem" href="../../ascii/">ASCII Operators</a></li><li><a class="tocitem" href="../../canon/">Canonical Models</a></li><li><a class="tocitem" href="../../api/">Library Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Zoo</a></li><li class="is-active"><a href>Brusselator</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Brusselator</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/AlgebraicJulia/Decapodes.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/AlgebraicJulia/Decapodes.jl/blob/main/docs/src/brussel/brussel.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Brusselator"><a class="docs-heading-anchor" href="#Brusselator">Brusselator</a><a id="Brusselator-1"></a><a class="docs-heading-anchor-permalink" href="#Brusselator" title="Permalink"></a></h1><p>This Brusselator example is adapted from <a href="https://docs.sciml.ai/DiffEqDocs/stable/tutorials/advanced_ode_example/">DifferentialEquations.jl</a>&#39;s page on the same topic. The <a href="https://en.wikipedia.org/wiki/Brusselator">Brusselator</a> is a autocatalytic chemical reaction that takes place between two reactants <code>U</code> and <code>V</code>.</p><h2 id="Dependencies"><a class="docs-heading-anchor" href="#Dependencies">Dependencies</a><a id="Dependencies-1"></a><a class="docs-heading-anchor-permalink" href="#Dependencies" title="Permalink"></a></h2><pre><code class="language-julia hljs">using CairoMakie
import CairoMakie: wireframe, mesh, Figure, Axis

using Catlab
using CombinatorialSpaces
using ComponentArrays
using DiagrammaticEquations
using Decapodes
using LinearAlgebra
using MLStyle
using OrdinaryDiffEq

using GeometryBasics: Point2, Point3
Point2D = Point2{Float64}
Point3D = Point3{Float64}</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">WARNING: using ComponentArrays.Axis in module Main conflicts with an existing identifier.</code></pre><h2 id="The-Model"><a class="docs-heading-anchor" href="#The-Model">The Model</a><a id="The-Model-1"></a><a class="docs-heading-anchor-permalink" href="#The-Model" title="Permalink"></a></h2><p>We establish the model for the Brusselator, with the two reactants <code>U</code> and <code>V</code>, modeled as residing on the vertices of the mesh. The equations encode a reaction that occurs independently at each point coupled with a diffusion term as well as a source term <code>F</code> in the case of <code>U</code>. Here <code>α</code> denotes the rate of diffusion for both reactants.</p><pre><code class="language-julia hljs">BrusselatorDynamics = @decapode begin
  (U, V)::Form0
  U2V::Form0
  (U̇, V̇)::Form0

  (α)::Constant
  F::Parameter

  U2V == (U .* U) .* V

  U̇ == 1 + U2V - (4.4 * U) + (α * Δ(U)) + F
  V̇ == (3.4 * U) - U2V + (α * Δ(V))
  ∂ₜ(U) == U̇
  ∂ₜ(V) == V̇
end</code></pre><h2 id="Boundary-Conditions"><a class="docs-heading-anchor" href="#Boundary-Conditions">Boundary Conditions</a><a id="Boundary-Conditions-1"></a><a class="docs-heading-anchor-permalink" href="#Boundary-Conditions" title="Permalink"></a></h2><p>We now establish the Dirichlet boundary conditions for our model. Here we intend to set some portion of the <code>U</code> variable to be a fixed value on some portion of the mesh. At this point the boundary conditions are only set symbolically and their actual implementation can change. Note that these values are set at the beginning of execution, as shown by the computation graph.</p><pre><code class="language-julia hljs">BrusselatorBoundaries = @decapode begin
  B::Constant
end

BrusselatorMorphism = @relation () begin
  rlb(C, Cb)
end

Brusselator = collate(
  BrusselatorDynamics,
  BrusselatorBoundaries,
  BrusselatorMorphism,
  Dict(
    :C =&gt; :U,
    :Cb =&gt; :B))

to_graphviz(Brusselator)</code></pre><img src="1b57ce4a.svg" alt="Example block output"/><h2 id="The-Mesh"><a class="docs-heading-anchor" href="#The-Mesh">The Mesh</a><a id="The-Mesh-1"></a><a class="docs-heading-anchor-permalink" href="#The-Mesh" title="Permalink"></a></h2><p>We load our triangulated mesh with horizontal and vertical resolution being <code>h=0.01</code>. <code>Point3D</code> is being used for the primal mesh <code>s</code> for ease of visualization while <code>Point2D</code> is used for the dual mesh <code>sd</code> for better memory usage. Since this conversion only drops the final z-coordinate, no information is lost.</p><pre><code class="language-julia hljs">h = 0.01
s = triangulated_grid(1,1,h,h,Point3D);
sd = EmbeddedDeltaDualComplex2D{Bool,Float64,Point2D}(s);
subdivide_duals!(sd, Circumcenter());

fig = Figure()
ax = CairoMakie.Axis(fig[1,1], aspect=1)
wf = wireframe!(ax, s; linewidth=1)
save(&quot;Brusselator_rect.png&quot;, fig)</code></pre><p><img src="../Brusselator_rect.png" alt="&quot;BrusselatorRect&quot;"/></p><h2 id="Initial-data"><a class="docs-heading-anchor" href="#Initial-data">Initial data</a><a id="Initial-data-1"></a><a class="docs-heading-anchor-permalink" href="#Initial-data" title="Permalink"></a></h2><p>We assign the initial values of <code>U</code> and <code>V</code> according to a continuous function. Since they both live on the vertices of our mesh, we can simply iterate over all point coordinates, extract the coordinate values (for either x or y) and compute the desired value. <code>F</code> has some logic attached to it encoding that it will &quot;activate&quot; only once the simulation has reached time <code>t = 1.1</code>.</p><p>Here we also decide to set our boundary conditions to be <code>1.0</code> along the left and right sides of our mesh.</p><pre><code class="language-julia hljs">U = map(sd[:point]) do (_,y)
  22 * (y *(1-y))^(3/2)
end

V = map(sd[:point]) do (x,_)
  27 * (x *(1-x))^(3/2)
end

fig = Figure()
ax = CairoMakie.Axis(fig[1,1], aspect=1, title = &quot;Initial value of U&quot;)
msh = CairoMakie.mesh!(ax, s, color=U, colormap=:jet, colorrange=extrema(U))
Colorbar(fig[1,2], msh)
save(&quot;initial_U.png&quot;, fig)

fig = Figure()
ax = CairoMakie.Axis(fig[1,1], aspect=1, title = &quot;Initial value of V&quot;)
msh = CairoMakie.mesh!(ax, s, color=V, colormap=:jet, colorrange=extrema(V))
Colorbar(fig[1,2], msh)
save(&quot;initial_V.png&quot;, fig)

F₁ = map(sd[:point]) do (x,y)
 (x-0.3)^2 + (y-0.6)^2 ≤ (0.1)^2 ? 5.0 : 0.0
end

F₂ = zeros(nv(sd))

constants_and_parameters = (
  α = 0.001,
  B = 1.0, # Boundary value
  F = t -&gt; t ≥ 1.1 ? F₁ : F₂)</code></pre><p><img src="../initial_U.png" alt="Initial U Conditions"/> <img src="../initial_V.png" alt="Initial V Conditions"/></p><pre><code class="language-julia hljs"># Find left and right vertices of mesh
min_x = minimum(x -&gt; x[1], s[:point])
max_x = maximum(x -&gt; x[1], s[:point])
left_wall_idxs = findall(x -&gt; x[1] == min_x, s[:point])
right_wall_idxs = findall(x -&gt; x[1] == max_x, s[:point])
wall_idxs = vcat(left_wall_idxs, right_wall_idxs)

function generate(sd, my_symbol; hodge=GeometricHodge())
  op = @match my_symbol begin
    :rlb =&gt; (x,y) -&gt; begin
      x[wall_idxs] .= y
      x
    end
    _ =&gt; error(&quot;Unmatched operator $my_symbol&quot;)
  end
end

fig = Figure()
ax = CairoMakie.Axis(fig[1,1], aspect=1, title = &quot;Highlighted Boundary&quot;)
value = zeros(nv(sd))
value[wall_idxs] .= 1.0
msh = CairoMakie.mesh!(ax, s, color=value, colormap=:jet, colorrange=(0,2))
Colorbar(fig[1,2], msh)
save(&quot;boundary.png&quot;, fig)</code></pre><p><img src="../boundary.png" alt="Boundary Visualized"/></p><h2 id="Generate-the-Simulation"><a class="docs-heading-anchor" href="#Generate-the-Simulation">Generate the Simulation</a><a id="Generate-the-Simulation-1"></a><a class="docs-heading-anchor-permalink" href="#Generate-the-Simulation" title="Permalink"></a></h2><p>We generate our simulation code and store the function in <code>fₘ</code> and then run our simulation for <code>t=11.5</code> simulated time units.</p><pre><code class="language-julia hljs">sim = evalsim(Brusselator)
fₘ = sim(sd, generate, DiagonalHodge())

u₀ = ComponentArray(U=U, V=V)

tₑ = 11.5

prob = ODEProblem(fₘ, u₀, (0, tₑ), constants_and_parameters)
soln = solve(prob, Tsit5())
soln.retcode</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ReturnCode.Success = 1</code></pre><h2 id="Visualize"><a class="docs-heading-anchor" href="#Visualize">Visualize</a><a id="Visualize-1"></a><a class="docs-heading-anchor-permalink" href="#Visualize" title="Permalink"></a></h2><p>We can then use Makie to visualize the evolution of our Brusselator model.</p><pre><code class="language-julia hljs">function save_dynamics(save_file_name)
  time = Observable(0.0)
  u = @lift(soln($time).U)
  v = @lift(soln($time).V)
  f = Figure(; size = (500, 850))
  ax_U = CairoMakie.Axis(f[1,1], title = @lift(&quot;Concentration of U at Time $($time)&quot;))
  ax_V = CairoMakie.Axis(f[2,1], title = @lift(&quot;Concentration of V at Time $($time)&quot;))

  msh_U = mesh!(ax_U, s, color=u, colormap=:jet, colorrange=extrema(soln(tₑ).U))
  Colorbar(f[1,2], msh_U)

  msh_V = mesh!(ax_V, s, color=v, colormap=:jet, colorrange=extrema(soln(tₑ).V))
  Colorbar(f[2,2], msh_V)

  timestamps = range(0, tₑ, step=1e-1)
  record(f, save_file_name, timestamps; framerate = 15) do t
    time[] = t
  end
end

save_dynamics(&quot;brusselator.gif&quot;)</code></pre><p><img src="../brusselator.gif" alt="Brusselator_results_flat"/></p><pre class="documenter-example-output"><code class="nohighlight hljs ansi">[ Info: Page built in 68 seconds.
[ Info: This page was last built at 2025-03-14T08:54:31.340.</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../ch/cahn-hilliard/">« Cahn-Hilliard</a><a class="docs-footer-nextpage" href="../../klausmeier/klausmeier/">Klausmeier »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.1 on <span class="colophon-date" title="Friday 14 March 2025 09:45">Friday 14 March 2025</span>. Using Julia version 1.10.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
